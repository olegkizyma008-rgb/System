Передмова:
Це адаптоване технічне завдання (ТЗ), що розширює можливості системи до універсального агента з виділеною надійною підсистемою для роботи з кодом.

⸻

ТЕХНІЧНЕ ЗАВДАННЯ
Універсальна Агентна Система з Інтегрованим Контуром Розробки (Dev Subsystem)

⸻

1. Мета системи

Реалізувати універсальну агентну систему, здатну виконувати широкий спектр завдань (рівень людини та вище), з чітким розділенням відповідальності для інженерних задач.

1.1 Універсальність
Система не є вузькоспеціалізованою. Вона повинна обробляти будь-які запити користувача (робота з ОС, браузером, документами тощо).

1.2 Спеціалізація на коді
Якщо завдання стосується розробки, зміни коду, аналізу коду або має будь-який натяк на програмування, воно передається в окремий контур — **Підсистему Розробки**. Це необхідно для забезпечення безпеки та якості змін у вже існуючій стабільній системі.

⸻

2. Архітектура Підсистеми Розробки

Підсистема розробки (Dev Subsystem) керується агентом **Copilot** і має два режими роботи. Критичною вимогою є заборона на пряме внесення змін у код самим агентом Copilot — він виступає як драйвер/аналітик, делегуючи виконання IDE або залишаючись у режимі аналізу.

2.1 Основний режим: Windsurf (Chat User Simulation)
*   **Логіка:** Copilot працює "поверх" Windsurf IDE.
*   **Роль:** Copilot імітує користувача. Він готує текст запиту, пояснення чи інструкції і відправляє їх у чат Windsurf (Cascade).
*   **Дія:** Тільки відправка текстових повідомлень у чат.
*   **Виконання змін:** Зміни в код вносить виключно Windsurf IDE на основі отриманих повідомлень.

2.2 Режим відмови (Fallback): Continue CLI
*   **Умова активації:** Якщо робота через Windsurf неможлива (технічний збій, відсутність відповіді, помилка інтерфейсу) — система автоматично перемикається на Continue CLI.
*   **Логіка:** Copilot використовує Continue CLI для прямого доступу до контексту проекту.
*   **Доступ:**
    *   Читання файлів.
    *   Пошук по кодовій базі.
    *   Використання інструментів аналізу Continue.
*   **Обмеження (КРИТИЧНО):** Сувора заборона вносити зміни у код (write/edit) через CLI інструменти в цьому режимі. Режим використовується для глибокого аналізу, діагностики або підготовки звіту для користувача, коли основний канал (Windsurf) недоступний.

⸻

3. Компоненти системи та Ролі

3.1 Router (Маршрутизатор)
*   Аналізує вхідний запит.
*   Якщо запит стосується коду/розробки → передає управління **Copilot Dev Subsystem**.
*   Якщо запит загальний (пошук, перегляд відео, ОС) → передає управління **General Agent**.

3.2 Copilot (Meta-Agent for Dev)
*   **Відповідальність:** Стратегування виконання кодових задач.
*   **Управління режимами:** Приймає рішення про перехід в Fallback режим (Continue CLI).
*   **Контроль:** Перевіряє, чи Windsurf виконав задачу коректно, аналізуючи відповіді.

3.3 Windsurf IDE (Execution Environment)
*   Працює як "чорна скринька", що приймає промпти і видає результат (код/відповідь).

3.4 Continue CLI (Fallback Tool)
*   Інструмент "останньої надії" для отримання інформації про код, коли Windsurf недоступний. Працює в Read-Only режимі для коду.

⸻

4. Потік взаємодії (Interaction Flow) для Dev-задач

1.  **Start:** Отримання задачі на розробку.
2.  **Try Mode 1 (Windsurf):**
    *   Copilot формує промпт.
    *   Відправка повідомлення в чат Windsurf.
    *   Очікування та аналіз відповіді.
    *   *Успіх:* Задача виконана → Stop.
    *   *Невдача/Помилка:* Перехід до кроку 3.
3.  **Fallback to Mode 2 (Continue CLI):**
    *   Copilot підключається до середовища через CLI.
    *   Виконує збір інформації (View/Search files).
    *   Формує звіт про ситуацію або план дій (без редагування коду).
    *   Повертає результат користувачеві.

⸻

5. Обмеження та Правила

1.  **Code Safety:** Агент Copilot ніколи не пише в файли коду напряму (ні через Windsurf-чат, бо це робить IDE, ні через Continue CLI, бо це заборонено правилами fallback).
2.  **Separation:** Кодові задачі ізольовані від загальних задач ОС.
3.  **Autonomy:** Система самостійно визначає необхідність переключення в Fallback режим без участі користувача.

⸻

6. Критерій успіху

Система успішно адаптована, якщо вона:
1.  Коректно розрізняє звичайні задачі та задачі розробки.
2.  Для задач розробки пріоритетно використовує Windsurf (імітація користувача).
3.  При збоях безшовно переходить на Continue CLI для аналізу, не порушуючи цілісність коду (read-only).