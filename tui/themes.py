import os
import json
from typing import Dict, List, Tuple

# Base themes
THEMES: Dict[str, Dict[str, str]] = {
    "monaco": {
        "frame.border": "#005f5f",
        "frame.label": "#008787",
        "header": "bg:#0d1117 #00afaf",
        "header.title": "#00afaf",
        "header.sep": "#1c2128",
        "header.label": "#3d5050",
        "header.value": "#87d7d7",
        "status": "bg:#0d1117",
        "status.ready": "#5faf87",
        "status.key": "#3d5050",
        "log.info": "#8b949e",
        "log.user": "#f2cc60",
        "log.action": "#5fafff",
        "log.error": "#d75f5f",
        "context": "bg:#0d1117",
        "context.title": "#00afaf",
        "context.label": "#3d5050",
        "context.value": "#87d7d7",
        "input": "bg:#0d1117 #d0d0d0",
        "input.prompt": "#00afaf",
        "menu": "bg:#0d1117",
        "menu.title": "#00afaf",
        "menu.item": "#8b949e",
        "menu.selected": "bg:#005f5f #afffff",
        "toggle.on": "#5faf87",
        "toggle.off": "#d75f5f",
        "status.menu": "bg:#875f00 #ffffff",
        "status.chat": "bg:#005f5f #afffff",
        "status.processing": "bg:#ff8700 #ffffff",
        "input.menu": "bg:#875f00 #ffffff",
        "input.hint": "#5f5f5f",
        "agent.atlas": "#00afaf",
        "agent.tetyana": "#5faf87",
        "agent.grisha": "#f2cc60",
        "agent.user": "#87d7d7",
        "agent.system": "#8b949e",
        "agent.text": "#d0d0d0",
        "scrollbar.background": "#0d1117",
        "scrollbar.button": "#00afaf",
        "scrollbar.arrow": "#008787",
        "button": "bg:#005f5f #afffff",
        "button.focused": "bg:#008787 #ffffff",
        "button.clicked": "bg:#5faf87 #ffffff",
        "bar.background": "#002b2b",
        "log.tool.success": "#5faf87",
        "log.tool.fail": "#d75f5f",
        "log.tool.run": "#f2cc60",
    },
    "dracula": {
        "frame.border": "#6272a4",
        "frame.label": "#8b7fc7",
        "header": "bg:#282a36 #8b7fc7",
        "header.title": "#bd93f9",
        "header.sep": "#44475a",
        "header.label": "#44475a",
        "header.value": "#c8c8c8",
        "status": "bg:#1e1f29",
        "status.ready": "#50fa7b",
        "status.key": "#44475a",
        "log.info": "#c8c8c8",
        "log.user": "#f1fa8c",
        "log.action": "#8be9fd",
        "log.error": "#ff5555",
        "context": "bg:#282a36",
        "context.title": "#bd93f9",
        "context.label": "#44475a",
        "context.value": "#c8c8c8",
        "input": "bg:#1e1f29 #f8f8f2",
        "input.prompt": "#50fa7b",
        "menu": "bg:#282a36",
        "menu.title": "#bd93f9",
        "menu.item": "#c8c8c8",
        "menu.selected": "bg:#6272a4 #f8f8f2",
        "toggle.on": "#50fa7b",
        "toggle.off": "#ff5555",
        "status.menu": "bg:#bd93f9 #282a36",
        "status.chat": "bg:#6272a4 #f8f8f2",
        "status.processing": "bg:#ffb86c #282a36",
        "input.menu": "bg:#bd93f9 #282a36",
        "input.hint": "#44475a",
        "agent.atlas": "#8be9fd",
        "agent.tetyana": "#50fa7b",
        "agent.grisha": "#f1fa8c",
        "agent.user": "#bd93f9",
        "agent.system": "#6272a4",
        "agent.text": "#f8f8f2",
        "scrollbar.background": "#282a36",
        "scrollbar.button": "bg:#44475a",
        "scrollbar.arrow": "#44475a",
        "log.tool.success": "#50fa7b",
        "log.tool.fail": "#ff5555",
        "log.tool.run": "#f1fa8c",
    },
    "nord": {
        "frame.border": "#4c566a",
        "frame.label": "#5e81ac",
        "header": "bg:#2e3440 #88c0d0",
        "header.title": "#88c0d0",
        "header.sep": "#3b4252",
        "header.label": "#4c566a",
        "header.value": "#d8dee9",
        "status": "bg:#2e3440",
        "status.ready": "#a3be8c",
        "status.key": "#4c566a",
        "log.info": "#d8dee9",
        "log.user": "#ebcb8b",
        "log.action": "#81a1c1",
        "log.error": "#bf616a",
        "context": "bg:#2e3440",
        "context.title": "#88c0d0",
        "context.label": "#4c566a",
        "context.value": "#d8dee9",
        "input": "bg:#3b4252 #eceff4",
        "input.prompt": "#a3be8c",
        "menu": "bg:#2e3440",
        "menu.title": "#88c0d0",
        "menu.item": "#d8dee9",
        "menu.selected": "bg:#4c566a #eceff4",
        "toggle.on": "#a3be8c",
        "toggle.off": "#bf616a",
        "status.menu": "bg:#88c0d0 #2e3440",
        "status.chat": "bg:#4c566a #eceff4",
        "status.processing": "bg:#ebcb8b #2e3440",
        "input.menu": "bg:#88c0d0 #2e3440",
        "input.hint": "#4c566a",
        "agent.atlas": "#88c0d0",
        "agent.tetyana": "#a3be8c",
        "agent.grisha": "#ebcb8b",
        "agent.user": "#81a1c1",
        "agent.system": "#4c566a",
        "agent.text": "#eceff4",
        "scrollbar.background": "#2e3440",
        "scrollbar.button": "bg:#4c566a",
        "scrollbar.arrow": "#4c566a",
        "log.tool.success": "#a3be8c",
        "log.tool.fail": "#bf616a",
        "log.tool.run": "#ebcb8b",
    },
    "gruvbox": {
        "frame.border": "#504945",
        "frame.label": "#a89984",
        "header": "bg:#282828 #d79921",
        "header.title": "#d79921",
        "header.sep": "#3c3836",
        "header.label": "#665c54",
        "header.value": "#d5c4a1",
        "status": "bg:#1d2021",
        "status.ready": "#b8bb26",
        "status.key": "#665c54",
        "log.info": "#d5c4a1",
        "log.user": "#fabd2f",
        "log.action": "#83a598",
        "log.error": "#fb4934",
        "context": "bg:#282828",
        "context.title": "#d79921",
        "context.label": "#665c54",
        "context.value": "#d5c4a1",
        "input": "bg:#1d2021 #fbf1c7",
        "input.prompt": "#b8bb26",
        "menu": "bg:#282828",
        "menu.title": "#d79921",
        "menu.item": "#d5c4a1",
        "menu.selected": "bg:#504945 #fbf1c7",
        "toggle.on": "#b8bb26",
        "toggle.off": "#fb4934",
        "status.menu": "bg:#d79921 #282828",
        "status.chat": "bg:#504945 #fbf1c7",
        "status.processing": "bg:#d79921 #282828",
        "input.menu": "bg:#d79921 #282828",
        "input.hint": "#665c54",
        "agent.atlas": "#83a598",
        "agent.tetyana": "#b8bb26",
        "agent.grisha": "#fabd2f",
        "agent.user": "#d79921",
        "agent.system": "#a89984",
        "agent.text": "#fbf1c7",
        "scrollbar.background": "#282828",
        "scrollbar.button": "bg:#504945",
        "scrollbar.arrow": "#504945",
        "log.tool.success": "#b8bb26",
        "log.tool.fail": "#fb4934",
        "log.tool.run": "#fabd2f",
    },
    "solarized-dark": {
        "frame.border": "#586e75",
        "frame.label": "#268bd2",
        "header": "bg:#002b36 #839496",
        "header.title": "#268bd2",
        "header.sep": "#073642",
        "header.label": "#586e75",
        "header.value": "#93a1a1",
        "status": "bg:#002b36",
        "status.ready": "#859900",
        "status.key": "#586e75",
        "log.info": "#839496",
        "log.user": "#b58900",
        "log.action": "#268bd2",
        "log.error": "#dc322f",
        "context": "bg:#002b36",
        "context.title": "#268bd2",
        "context.label": "#586e75",
        "context.value": "#93a1a1",
        "input": "bg:#073642 #93a1a1",
        "input.prompt": "#859900",
        "menu": "bg:#002b36",
        "menu.title": "#268bd2",
        "menu.item": "#839496",
        "menu.selected": "bg:#586e75 #fdf6e3",
        "toggle.on": "#859900",
        "toggle.off": "#dc322f",
        "status.menu": "bg:#268bd2 #002b36",
        "status.chat": "bg:#586e75 #fdf6e3",
        "status.processing": "bg:#b58900 #002b36",
        "input.menu": "bg:#268bd2 #002b36",
        "input.hint": "#586e75",
        "agent.atlas": "#2aa198",
        "agent.tetyana": "#859900",
        "agent.grisha": "#b58900",
        "agent.user": "#268bd2",
        "agent.system": "#586e75",
        "agent.text": "#93a1a1",
        "scrollbar.background": "#002b36",
        "scrollbar.button": "bg:#073642",
        "scrollbar.arrow": "#073642",
        "log.tool.success": "#859900",
        "log.tool.fail": "#dc322f",
        "log.tool.run": "#b58900",
    },
    "one-dark": {
        "frame.border": "#5c6370",
        "frame.label": "#61afef",
        "header": "bg:#21252b #abb2bf",
        "header.title": "#61afef",
        "header.sep": "#3e4451",
        "header.label": "#5c6370",
        "header.value": "#abb2bf",
        "status": "bg:#21252b",
        "status.ready": "#98c379",
        "status.key": "#5c6370",
        "log.info": "#abb2bf",
        "log.user": "#e5c07b",
        "log.action": "#61afef",
        "log.error": "#e06c75",
        "context": "bg:#282c34",
        "context.title": "#61afef",
        "context.label": "#5c6370",
        "context.value": "#abb2bf",
        "input": "bg:#21252b #abb2bf",
        "input.prompt": "#98c379",
        "menu": "bg:#282c34",
        "menu.title": "#61afef",
        "menu.item": "#abb2bf",
        "menu.selected": "bg:#3e4451 #ffffff",
        "toggle.on": "#98c379",
        "toggle.off": "#e06c75",
        "status.menu": "bg:#61afef #21252b",
        "status.chat": "bg:#3e4451 #ffffff",
        "status.processing": "bg:#e5c07b #21252b",
        "input.menu": "bg:#61afef #21252b",
        "input.hint": "#5c6370",
        "agent.atlas": "#56b6c2",
        "agent.tetyana": "#98c379",
        "agent.grisha": "#e5c07b",
        "agent.user": "#c678dd",
        "agent.system": "#5c6370",
        "agent.text": "#abb2bf",
        "scrollbar.background": "#282c34",
        "scrollbar.button": "bg:#3e4451",
        "scrollbar.arrow": "#3e4451",
        "log.tool.success": "#98c379",
        "log.tool.fail": "#e06c75",
        "log.tool.run": "#e5c07b",
    },
    "catppuccin": {
        "frame.border": "#6c7086",
        "frame.label": "#89b4fa",
        "header": "bg:#1e1e2e #cdd6f4",
        "header.title": "#89b4fa",
        "header.sep": "#313244",
        "header.label": "#6c7086",
        "header.value": "#cdd6f4",
        "status": "bg:#1e1e2e",
        "status.ready": "#a6e3a1",
        "status.key": "#6c7086",
        "log.info": "#cdd6f4",
        "log.user": "#f9e2af",
        "log.action": "#89b4fa",
        "log.error": "#f38ba8",
        "context": "bg:#1e1e2e",
        "context.title": "#89b4fa",
        "context.label": "#6c7086",
        "context.value": "#cdd6f4",
        "input": "bg:#181825 #cdd6f4",
        "input.prompt": "#a6e3a1",
        "menu": "bg:#1e1e2e",
        "menu.title": "#89b4fa",
        "menu.item": "#cdd6f4",
        "menu.selected": "bg:#45475a #cdd6f4",
        "toggle.on": "#a6e3a1",
        "toggle.off": "#f38ba8",
        "status.menu": "bg:#cba6f7 #1e1e2e",
        "status.chat": "bg:#45475a #cdd6f4",
        "status.processing": "bg:#fab387 #1e1e2e",
        "input.menu": "bg:#cba6f7 #1e1e2e",
        "input.hint": "#6c7086",
        "agent.atlas": "#89dceb",
        "agent.tetyana": "#a6e3a1",
        "agent.grisha": "#f9e2af",
        "agent.user": "#cba6f7",
        "agent.system": "#6c7086",
        "agent.text": "#cdd6f4",
        "scrollbar.background": "#1e1e2e",
        "scrollbar.button": "bg:#313244",
        "scrollbar.arrow": "#313244",
        "log.tool.success": "#a6e3a1",
        "log.tool.fail": "#f38ba8",
        "log.tool.run": "#f9e2af",
    },
    "tokyo-night": {
        "frame.border": "#565f89",
        "frame.label": "#7aa2f7",
        "header": "bg:#1a1b26 #a9b1d6",
        "header.title": "#7aa2f7",
        "header.sep": "#24283b",
        "header.label": "#565f89",
        "header.value": "#a9b1d6",
        "status": "bg:#1a1b26",
        "status.ready": "#9ece6a",
        "status.key": "#565f89",
        "log.info": "#a9b1d6",
        "log.user": "#e0af68",
        "log.action": "#7aa2f7",
        "log.error": "#f7768e",
        "context": "bg:#1a1b26",
        "context.title": "#7aa2f7",
        "context.label": "#565f89",
        "context.value": "#a9b1d6",
        "input": "bg:#16161e #c0caf5",
        "input.prompt": "#9ece6a",
        "menu": "bg:#1a1b26",
        "menu.title": "#7aa2f7",
        "menu.item": "#a9b1d6",
        "menu.selected": "bg:#33467c #c0caf5",
        "toggle.on": "#9ece6a",
        "toggle.off": "#f7768e",
        "status.menu": "bg:#bb9af7 #1a1b26",
        "status.chat": "bg:#33467c #c0caf5",
        "status.processing": "bg:#ff9e64 #1a1b26",
        "input.menu": "bg:#bb9af7 #1a1b26",
        "input.hint": "#565f89",
        "agent.atlas": "#7dcfff",
        "agent.tetyana": "#9ece6a",
        "agent.grisha": "#e0af68",
        "agent.user": "#bb9af7",
        "agent.system": "#565f89",
        "agent.text": "#c0caf5",
        "scrollbar.background": "#1a1b26",
        "scrollbar.button": "bg:#24283b",
        "scrollbar.arrow": "#24283b",
        "log.tool.success": "#9ece6a",
        "log.tool.fail": "#f7768e",
        "log.tool.run": "#e0af68",
    },
    "rose-pine": {
        "frame.border": "#6e6a86",
        "frame.label": "#9ccfd8",
        "header": "bg:#191724 #e0def4",
        "header.title": "#9ccfd8",
        "header.sep": "#26233a",
        "header.label": "#6e6a86",
        "header.value": "#e0def4",
        "status": "bg:#191724",
        "status.ready": "#31748f",
        "status.key": "#6e6a86",
        "log.info": "#e0def4",
        "log.user": "#f6c177",
        "log.action": "#9ccfd8",
        "log.error": "#eb6f92",
        "context": "bg:#191724",
        "context.title": "#9ccfd8",
        "context.label": "#6e6a86",
        "context.value": "#e0def4",
        "input": "bg:#1f1d2e #e0def4",
        "input.prompt": "#31748f",
        "menu": "bg:#191724",
        "menu.title": "#9ccfd8",
        "menu.item": "#e0def4",
        "menu.selected": "bg:#403d52 #e0def4",
        "toggle.on": "#31748f",
        "toggle.off": "#eb6f92",
        "status.menu": "bg:#c4a7e7 #191724",
        "status.chat": "bg:#403d52 #e0def4",
        "status.processing": "bg:#f6c177 #191724",
        "input.menu": "bg:#c4a7e7 #191724",
        "input.hint": "#6e6a86",
        "agent.atlas": "#9ccfd8",
        "agent.tetyana": "#31748f",
        "agent.grisha": "#f6c177",
        "agent.user": "#c4a7e7",
        "agent.system": "#6e6a86",
        "agent.text": "#e0def4",
        "scrollbar.background": "#191724",
        "scrollbar.button": "bg:#26233a",
        "scrollbar.arrow": "#26233a",
        "log.tool.success": "#31748f",
        "log.tool.fail": "#eb6f92",
        "log.tool.run": "#f6c177",
    },
}

def load_custom_themes() -> None:
    """Load user themes from ~/.system_cli/themes/*.json"""
    try:
        custom_dir = os.path.expanduser("~/.system_cli/themes")
        if not os.path.exists(custom_dir):
            return
        
        for filename in os.listdir(custom_dir):
            if filename.endswith(".json"):
                path = os.path.join(custom_dir, filename)
                try:
                    with open(path, "r", encoding="utf-8") as f:
                        theme_data = json.load(f)
                        name = filename[:-5]
                        if isinstance(theme_data, dict):
                            THEMES[name] = theme_data
                except Exception:
                    continue
    except Exception:
        pass

# Initial load
load_custom_themes()

def get_theme_names() -> Tuple[str, ...]:
    """Return sorted list of all available theme names."""
    return tuple(sorted(THEMES.keys()))

# Support old global variable for compatibility where possible
THEME_NAMES = get_theme_names()

